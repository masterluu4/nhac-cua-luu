<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Music Player No-Ads</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; padding: 20px; background: #121212; color: #e0e0e0; margin: 0; }
        h2 { text-align: center; color: #bb86fc; }
        input { width: 100%; padding: 12px; margin-bottom: 15px; background: #333; border: 1px solid #444; color: white; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        button { width: 100%; padding: 12px; background: #bb86fc; border: none; color: black; font-weight: bold; border-radius: 8px; font-size: 16px; cursor: pointer; }
        .result-item { padding: 15px; border-bottom: 1px solid #333; cursor: pointer; display: flex; align-items: center; }
        .result-item:active { background: #333; }
        #player-controls { position: fixed; bottom: 0; left: 0; right: 0; background: #1f1f1f; padding: 15px; text-align: center; border-top: 1px solid #333; box-shadow: 0 -2px 10px rgba(0,0,0,0.5); }
        audio { width: 100%; margin-top: 10px; outline: none; }
        /* Ẩn thanh cuộn để nhìn giống App hơn */
        ::-webkit-scrollbar { width: 0px; background: transparent; }
    </style>
</head>
<body>
    <h2>YouTube Audio Player</h2>
    <input type="text" id="searchInput" placeholder="Nhập tên bài hát...">
    <button onclick="searchMusic()">Tìm kiếm</button>
    <div id="results" style="margin-bottom: 100px; margin-top: 20px;"></div>

    <div id="player-controls" style="display:none;">
        <div id="nowPlaying" style="font-weight:bold; margin-bottom: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Đang tải...</div>
        <audio id="audioPlayer" controls loop autoplay></audio>
    </div>

    <script>
        const API_URL = "https://pipedapi.kavin.rocks"; 

        async function searchMusic() {
            const btn = document.querySelector('button');
            btn.innerText = "Đang tìm...";
            const query = document.getElementById('searchInput').value;
            try {
                const res = await fetch(`${API_URL}/search?q=${query}&filter=music_songs`);
                const data = await res.json();
                const list = document.getElementById('results');
                list.innerHTML = '';
                data.items.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'result-item';
                    div.innerHTML = `<div>${item.title}</div>`;
                    div.onclick = () => playSong(item.url.split('v=')[1], item.title);
                    list.appendChild(div);
                });
            } catch (e) { alert("Lỗi kết nối API, thử lại sau!"); }
            btn.innerText = "Tìm kiếm";
        }

        async function playSong(videoId, title) {
            document.getElementById('player-controls').style.display = 'block';
            document.getElementById('nowPlaying').innerText = "Đang lấy link audio: " + title;
            
            try {
                const res = await fetch(`${API_URL}/streams/${videoId}`);
                const data = await res.json();
                const audioStream = data.audioStreams.find(s => s.mimeType.includes('mp4') || s.mimeType.includes('webm'));
                
                if(audioStream) {
                    const player = document.getElementById('audioPlayer');
                    player.src = audioStream.url;
                    document.getElementById('nowPlaying').innerText = title;
                    player.play();
                    
                    if ('mediaSession' in navigator) {
                        navigator.mediaSession.metadata = new MediaMetadata({
                            title: title, artist: "My Custom Player",
                            artwork: [{ src: data.thumbnailUrl, sizes: '512x512', type: 'image/jpeg' }]
                        });
                    }
                } else { alert("Không tìm thấy luồng audio cho bài này."); }
            } catch (e) { alert("Không thể tải bài hát này."); }
        }
    </script>
</body>
</html>